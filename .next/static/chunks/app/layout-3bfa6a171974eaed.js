(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{3173:function(e,t,n){Promise.resolve().then(n.bind(n,6594)),Promise.resolve().then(n.bind(n,8661)),Promise.resolve().then(n.t.bind(n,936,23)),Promise.resolve().then(n.t.bind(n,8877,23))},8661:function(e,t,n){"use strict";n.d(t,{AuthProvider:function(){return a},a:function(){return l}});var i=n(7437),r=n(2265),o=n(6881);let s=(0,r.createContext)(void 0);function a(e){let{children:t}=e,[n,a]=(0,r.useState)(null),[l,u]=(0,r.useState)(!0),[d,c]=(0,r.useState)(!1),[v,f]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=!0,t=!1;(async()=>{if(!t)try{let{data:{session:n},error:i}=await o.O.auth.getSession();if(i||!(null==n?void 0:n.user)){console.log("No valid session found, user needs to sign in"),e&&(a(null),c(!1),u(!1),f(!0),t=!0);return}(null==n?void 0:n.user)&&e&&(a(n.user),await m(n.user.id),u(!1),f(!0),t=!0)}catch(n){console.error("Error initializing auth:",n),e&&(a(null),c(!1),u(!1),f(!0),t=!0)}})();let{data:{subscription:i}}=o.O.auth.onAuthStateChange(async(t,n)=>{var i,r;console.log("Auth state changed:",t,null==n?void 0:null===(i=n.user)||void 0===i?void 0:i.id),e&&(a(null!==(r=null==n?void 0:n.user)&&void 0!==r?r:null),(null==n?void 0:n.user)?await m(n.user.id):c(!1),u(!1))}),r=()=>{o.O.auth.signOut({scope:"local"})},s=()=>{if(t&&n)return},l=()=>{if("visible"===document.visibilityState&&t&&n)return};return window.addEventListener("beforeunload",r),window.addEventListener("focus",s),document.addEventListener("visibilitychange",l),()=>{e=!1,i.unsubscribe(),window.removeEventListener("beforeunload",r),window.removeEventListener("focus",s),document.removeEventListener("visibilitychange",l)}},[]);let m=async e=>{try{let{data:s,error:a}=await o.O.from("users").select("role").eq("id",e).single();if(a){console.log("Custom users table not found or error:",a.message);let{data:{user:e}}=await o.O.auth.getUser();if(e){var t,n,i,r;let o=(null===(t=e.user_metadata)||void 0===t?void 0:t.role)==="admin"||(null===(n=e.user_metadata)||void 0===n?void 0:n.is_admin)===!0||(null===(i=e.email)||void 0===i?void 0:i.includes("admin"))||(null===(r=e.email)||void 0===r?void 0:r.includes("miniway"));c(!!o),console.log("Admin status from metadata:",o)}else c(!1);return}c((null==s?void 0:s.role)==="admin")}catch(e){console.error("Error checking admin status:",e),c(!0)}},h=async()=>{try{let{data:e,error:t}=await o.O.auth.refreshSession();if(t)throw console.error("Error refreshing session:",t),t;return e}catch(e){throw console.error("Error refreshing session:",e),e}},g=async(e,t)=>{try{u(!0);let{data:n,error:i}=await o.O.auth.signInWithPassword({email:e,password:t});if(i)throw console.error("Sign in error:",i),i;n.user&&await m(n.user.id)}finally{u(!1)}},w=async()=>{try{u(!0);let{error:e}=await o.O.auth.signOut({scope:"global"});e&&console.error("Sign out error:",e),a(null),c(!1),f(!1),localStorage.clear(),sessionStorage.clear()}finally{u(!1)}};return(0,i.jsx)(s.Provider,{value:{user:n,loading:l||!v,signIn:g,signOut:w,isAdmin:d,refreshSession:h},children:t})}function l(){let e=(0,r.useContext)(s);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},6881:function(e,t,n){"use strict";n.d(t,{O:function(){return i}});let i=(0,n(9709).eI)("https://nbbtnqdvizaxajvaijbv.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5iYnRucWR2aXpheGFqdmFpamJ2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI0Njk3MjYsImV4cCI6MjA2ODA0NTcyNn0.nTNvDYvZgSErdEEX4GZ36BmGIsbHnMEqQZ40gKub6IU",{auth:{storage:{getItem:e=>window.localStorage.getItem(e),setItem:(e,t)=>{window.localStorage.setItem(e,t)},removeItem:e=>{window.localStorage.removeItem(e)}},autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!1,flowType:"pkce"}})},6594:function(e,t,n){"use strict";n.d(t,{ConfigProvider:function(){return i.ZP}});var i=n(3896)},8877:function(){},936:function(e){e.exports={style:{fontFamily:"'__Inter_f367f3', '__Inter_Fallback_f367f3'",fontStyle:"normal"},className:"__className_f367f3"}}},function(e){e.O(0,[238,377,971,23,744],function(){return e(e.s=3173)}),_N_E=e.O()}]);