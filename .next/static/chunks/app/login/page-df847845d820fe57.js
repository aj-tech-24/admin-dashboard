(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{9982:function(e,t,n){Promise.resolve().then(n.bind(n,4377))},4377:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return S}});var r=n(7437),i=n(729),s=n(5630),a=n(2988),o=n(2265),l={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zM332 240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224H332V240zm460 600H232V536h560v304zM484 701v53c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-53a48.01 48.01 0 10-56 0z"}}]},name:"lock",theme:"outlined"},c=n(5636),u=o.forwardRef(function(e,t){return o.createElement(c.Z,(0,a.Z)({},e,{ref:t,icon:l}))}),d=n(9569),h=n(8569),m=n(8357),f=n(8556),v=n(5325),g=n(8256),w=n(8421),y=n(6463),p=n(8661);let{Title:x,Text:I}=d.default;function S(){let[e,t]=(0,o.useState)(!1),{signIn:n}=(0,p.a)(),a=(0,y.useRouter)(),l=async e=>{try{t(!0),await n(e.email,e.password),h.ZP.success("Login successful!"),a.push("/")}catch(e){h.ZP.error(e.message||"Login failed")}finally{t(!1)}};return(0,r.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",padding:"20px"},children:(0,r.jsxs)(m.Z,{style:{width:"100%",maxWidth:400,boxShadow:"0 8px 32px rgba(0, 0, 0, 0.1)"},children:[(0,r.jsxs)("div",{style:{textAlign:"center",marginBottom:"32px"},children:[(0,r.jsx)(i.Z,{style:{fontSize:"48px",color:"#1890ff",marginBottom:"16px"}}),(0,r.jsx)(x,{level:2,style:{margin:0,color:"#1890ff"},children:"Miniway Admin"}),(0,r.jsx)(I,{type:"secondary",children:"Transportation Management System"})]}),(0,r.jsxs)(f.Z,{name:"login",onFinish:l,autoComplete:"off",size:"large",children:[(0,r.jsx)(f.Z.Item,{name:"email",rules:[{required:!0,message:"Please input your email!"},{type:"email",message:"Please enter a valid email!"}],children:(0,r.jsx)(v.default,{prefix:(0,r.jsx)(s.Z,{}),placeholder:"Email"})}),(0,r.jsx)(f.Z.Item,{name:"password",rules:[{required:!0,message:"Please input your password!"}],children:(0,r.jsx)(v.default.Password,{prefix:(0,r.jsx)(u,{}),placeholder:"Password"})}),(0,r.jsx)(f.Z.Item,{children:(0,r.jsx)(g.ZP,{type:"primary",htmlType:"submit",style:{width:"100%"},loading:e,children:e?(0,r.jsx)(w.Z,{size:"small"}):"Sign In"})})]}),(0,r.jsx)("div",{style:{textAlign:"center",marginTop:"16px"},children:(0,r.jsx)(I,{type:"secondary",style:{fontSize:"12px"},children:"Admin access only. Contact system administrator for credentials."})})]})})}},8661:function(e,t,n){"use strict";n.d(t,{AuthProvider:function(){return o},a:function(){return l}});var r=n(7437),i=n(2265),s=n(6881);let a=(0,i.createContext)(void 0);function o(e){let{children:t}=e,[n,o]=(0,i.useState)(null),[l,c]=(0,i.useState)(!0),[u,d]=(0,i.useState)(!1),[h,m]=(0,i.useState)(!1);(0,i.useEffect)(()=>{let e=!0,t=!1;(async()=>{if(!t)try{let{data:{session:n},error:r}=await s.O.auth.getSession();if(r||!(null==n?void 0:n.user)){console.log("No valid session found, user needs to sign in"),e&&(o(null),d(!1),c(!1),m(!0),t=!0);return}(null==n?void 0:n.user)&&e&&(o(n.user),await f(n.user.id),c(!1),m(!0),t=!0)}catch(n){console.error("Error initializing auth:",n),e&&(o(null),d(!1),c(!1),m(!0),t=!0)}})();let{data:{subscription:r}}=s.O.auth.onAuthStateChange(async(t,n)=>{var r,i;console.log("Auth state changed:",t,null==n?void 0:null===(r=n.user)||void 0===r?void 0:r.id),e&&(o(null!==(i=null==n?void 0:n.user)&&void 0!==i?i:null),(null==n?void 0:n.user)?await f(n.user.id):d(!1),c(!1))}),i=()=>{s.O.auth.signOut({scope:"local"})},a=()=>{if(t&&n)return},l=()=>{if("visible"===document.visibilityState&&t&&n)return};return window.addEventListener("beforeunload",i),window.addEventListener("focus",a),document.addEventListener("visibilitychange",l),()=>{e=!1,r.unsubscribe(),window.removeEventListener("beforeunload",i),window.removeEventListener("focus",a),document.removeEventListener("visibilitychange",l)}},[]);let f=async e=>{try{let{data:a,error:o}=await s.O.from("users").select("role").eq("id",e).single();if(o){console.log("Custom users table not found or error:",o.message);let{data:{user:e}}=await s.O.auth.getUser();if(e){var t,n,r,i;let s=(null===(t=e.user_metadata)||void 0===t?void 0:t.role)==="admin"||(null===(n=e.user_metadata)||void 0===n?void 0:n.is_admin)===!0||(null===(r=e.email)||void 0===r?void 0:r.includes("admin"))||(null===(i=e.email)||void 0===i?void 0:i.includes("miniway"));d(!!s),console.log("Admin status from metadata:",s)}else d(!1);return}d((null==a?void 0:a.role)==="admin")}catch(e){console.error("Error checking admin status:",e),d(!0)}},v=async()=>{try{let{data:e,error:t}=await s.O.auth.refreshSession();if(t)throw console.error("Error refreshing session:",t),t;return e}catch(e){throw console.error("Error refreshing session:",e),e}},g=async(e,t)=>{try{c(!0);let{data:n,error:r}=await s.O.auth.signInWithPassword({email:e,password:t});if(r)throw console.error("Sign in error:",r),r;n.user&&await f(n.user.id)}finally{c(!1)}},w=async()=>{try{c(!0);let{error:e}=await s.O.auth.signOut({scope:"global"});e&&console.error("Sign out error:",e),o(null),d(!1),m(!1),localStorage.clear(),sessionStorage.clear()}finally{c(!1)}};return(0,r.jsx)(a.Provider,{value:{user:n,loading:l||!h,signIn:g,signOut:w,isAdmin:u,refreshSession:v},children:t})}function l(){let e=(0,i.useContext)(a);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},6881:function(e,t,n){"use strict";n.d(t,{O:function(){return r}});let r=(0,n(9709).eI)("https://nbbtnqdvizaxajvaijbv.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5iYnRucWR2aXpheGFqdmFpamJ2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI0Njk3MjYsImV4cCI6MjA2ODA0NTcyNn0.nTNvDYvZgSErdEEX4GZ36BmGIsbHnMEqQZ40gKub6IU",{auth:{storage:{getItem:e=>window.localStorage.getItem(e),setItem:(e,t)=>{window.localStorage.setItem(e,t)},removeItem:e=>{window.localStorage.removeItem(e)}},autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!1,flowType:"pkce"}})},729:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(2988),i=n(2265),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M380 704h264c4.4 0 8-3.6 8-8v-84c0-4.4-3.6-8-8-8h-40c-4.4 0-8 3.6-8 8v36H428v-36c0-4.4-3.6-8-8-8h-40c-4.4 0-8 3.6-8 8v84c0 4.4 3.6 8 8 8zm340-123a40 40 0 1080 0 40 40 0 10-80 0zm239-167.6L935.3 372a8 8 0 00-10.9-2.9l-50.7 29.6-78.3-216.2a63.9 63.9 0 00-60.9-44.4H301.2c-34.7 0-65.5 22.4-76.2 55.5l-74.6 205.2-50.8-29.6a8 8 0 00-10.9 2.9L65 413.4c-2.2 3.8-.9 8.6 2.9 10.8l60.4 35.2-14.5 40c-1.2 3.2-1.8 6.6-1.8 10v348.2c0 15.7 11.8 28.4 26.3 28.4h67.6c12.3 0 23-9.3 25.6-22.3l7.7-37.7h545.6l7.7 37.7c2.7 13 13.3 22.3 25.6 22.3h67.6c14.5 0 26.3-12.7 26.3-28.4V509.4c0-3.4-.6-6.8-1.8-10l-14.5-40 60.3-35.2a8 8 0 003-10.8zM840 517v237H184V517l15.6-43h624.8l15.6 43zM292.7 218.1l.5-1.3.4-1.3c1.1-3.3 4.1-5.5 7.6-5.5h427.6l75.4 208H220l72.7-199.9zM224 581a40 40 0 1080 0 40 40 0 10-80 0z"}}]},name:"car",theme:"outlined"},a=n(5636),o=i.forwardRef(function(e,t){return i.createElement(a.Z,(0,r.Z)({},e,{ref:t,icon:s}))})},5630:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(2988),i=n(2265),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M858.5 763.6a374 374 0 00-80.6-119.5 375.63 375.63 0 00-119.5-80.6c-.4-.2-.8-.3-1.2-.5C719.5 518 760 444.7 760 362c0-137-111-248-248-248S264 225 264 362c0 82.7 40.5 156 102.8 201.1-.4.2-.8.3-1.2.5-44.8 18.9-85 46-119.5 80.6a375.63 375.63 0 00-80.6 119.5A371.7 371.7 0 00136 901.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8 2-77.2 33-149.5 87.8-204.3 56.7-56.7 132-87.9 212.2-87.9s155.5 31.2 212.2 87.9C779 752.7 810 825 812 902.2c.1 4.4 3.6 7.8 8 7.8h60a8 8 0 008-8.2c-1-47.8-10.9-94.3-29.5-138.2zM512 534c-45.9 0-89.1-17.9-121.6-50.4S340 407.9 340 362c0-45.9 17.9-89.1 50.4-121.6S466.1 190 512 190s89.1 17.9 121.6 50.4S684 316.1 684 362c0 45.9-17.9 89.1-50.4 121.6S557.9 534 512 534z"}}]},name:"user",theme:"outlined"},a=n(5636),o=i.forwardRef(function(e,t){return i.createElement(a.Z,(0,r.Z)({},e,{ref:t,icon:s}))})}},function(e){e.O(0,[377,943,866,556,971,23,744],function(){return e(e.s=9982)}),_N_E=e.O()}]);