(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[240],{8864:function(e,s,r){Promise.resolve().then(r.bind(r,2288))},2288:function(e,s,r){"use strict";r.r(s),r.d(s,{default:function(){return E}});var n=r(7437),t=r(3098),l=r(4816),c=r(729),i=r(6964),a=r(5630),o=r(7834),d=r(9569),u=r(7689),h=r(5325),x=r(8569),p=r(3650),m=r(3288),g=r(8256),v=r(8421),j=r(7733),y=r(5381),b=r(8357),f=r(6e3),Z=r(7149),w=r(9874),S=r(6463),_=r(2265),k=r(8643),C=r(1370),T=r(8661);let{Title:A,Text:U}=d.default,{Option:N}=u.default,{Search:z}=h.default;function E(){let{user:e,loading:s,isAdmin:r}=(0,T.a)(),d=(0,S.useRouter)(),[h,E]=(0,_.useState)([]),[D,P]=(0,_.useState)([]),[B,I]=(0,_.useState)([]),[O,L]=(0,_.useState)([]),[F,K]=(0,_.useState)(!0),[q,J]=(0,_.useState)(""),[M,Q]=(0,_.useState)("all");(0,_.useEffect)(()=>{s||e?s||!e||r||(x.ZP.error("Access denied. Admin privileges required."),d.push("/")):d.push("/login")},[e,s,r,d]),(0,_.useEffect)(()=>(e&&r&&(R(),W()),()=>{C.sn.unsubscribe("users")}),[e,r]);let R=async()=>{try{K(!0);let e=await (0,k.AW)();E(e.data||[]);let s=await (0,k.Eq)("driver");P(s.data||[]);let r=await (0,k.Eq)("conductor");I(r.data||[]);let n=await (0,k.Eq)("commuter");L(n.data||[]);let t=(e.data||[]).length;0===t&&x.ZP.info("No users found in the database. Users will appear here once they register through the mobile app.")}catch(e){console.error("Error loading users data:",e),x.ZP.error("Failed to load users data")}finally{K(!1)}},W=()=>{C.sn.subscribeToUsers({onUserUpdate:e=>{R()}})},V=e=>{let s={admin:{color:"red",text:"Admin"},driver:{color:"blue",text:"Driver"},conductor:{color:"green",text:"Conductor"},commuter:{color:"default",text:"Commuter"}}[e];return(0,n.jsx)(p.Z,{color:s.color,children:s.text})},G=e=>new Date(e).toLocaleString(),H=e=>!!e&&new Date(e)<new Date,X=e=>{let s=e;return q&&(s=s.filter(e=>{var s,r,n;return(null===(s=e.fullName)||void 0===s?void 0:s.toLowerCase().includes(q.toLowerCase()))||(null===(r=e.contact_number)||void 0===r?void 0:r.includes(q))||(null===(n=e.license_number)||void 0===n?void 0:n.includes(q))})),"all"!==M&&(s=s.filter(e=>e.role===M)),s},Y=[{title:"Name",key:"name",render:e=>(0,n.jsxs)("div",{children:[(0,n.jsx)(U,{strong:!0,children:e.fullName||"N/A"}),e.contact_number&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("br",{}),(0,n.jsx)(U,{type:"secondary",style:{fontSize:"12px"},children:e.contact_number})]})]})},{title:"Role",dataIndex:"role",key:"role",render:e=>V(e)},{title:"Contact",key:"contact",render:e=>(0,n.jsxs)("div",{children:[(0,n.jsx)(U,{children:e.contact_number||"N/A"}),e.emergency_contact&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("br",{}),(0,n.jsxs)(U,{type:"secondary",style:{fontSize:"12px"},children:["Emergency: ",e.emergency_contact]})]})]})},{title:"License Info",key:"license",render:e=>"driver"===e.role?(0,n.jsxs)("div",{children:[(0,n.jsx)(U,{style:{fontSize:"12px"},children:e.license_number||"N/A"}),e.license_expiry&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("br",{}),(0,n.jsxs)(U,{type:"secondary",style:{fontSize:"12px",color:H(e.license_expiry)?"#ff4d4f":void 0},children:["Expires:"," ",new Date(e.license_expiry).toLocaleDateString(),H(e.license_expiry)&&" (Expired)"]})]})]}):(0,n.jsx)(U,{type:"secondary",children:"N/A"})},{title:"Push Token",dataIndex:"push_token",key:"push_token",render:e=>e?(0,n.jsx)(p.Z,{color:"green",children:"Active"}):(0,n.jsx)(p.Z,{color:"red",children:"Inactive"})},{title:"Last Updated",dataIndex:"updated_at",key:"updated_at",render:e=>G(e)},{title:"Actions",key:"actions",render:e=>(0,n.jsx)(m.Z,{children:(0,n.jsx)(g.ZP,{type:"link",icon:(0,n.jsx)(t.Z,{}),onClick:()=>{x.ZP.info("User details feature coming soon")},children:"View Details"})})}],$=D.length,ee=B.length,es=O.length,er=h.filter(e=>"admin"===e.role).length,en=D.filter(e=>H(e.license_expiry)).length;return s||F?(0,n.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,n.jsx)(v.Z,{size:"large"})}):(0,n.jsxs)("div",{className:"admin-layout",children:[(0,n.jsxs)("div",{className:"admin-header",children:[(0,n.jsx)("div",{className:"admin-logo",children:"Miniway Admin Dashboard"}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[(0,n.jsx)(g.ZP,{onClick:()=>d.push("/"),children:"Dashboard"}),(0,n.jsx)(g.ZP,{onClick:R,icon:(0,n.jsx)(l.Z,{}),children:"Refresh"})]})]}),(0,n.jsxs)("div",{className:"admin-content",children:[(0,n.jsx)(j.Z,{gutter:[16,16],style:{marginBottom:"24px"},children:(0,n.jsxs)(y.Z,{span:24,children:[(0,n.jsx)(A,{level:2,children:"User Management"}),(0,n.jsx)(U,{type:"secondary",children:"Manage drivers, conductors, commuters, and system administrators"})]})}),(0,n.jsxs)(j.Z,{gutter:[16,16],style:{marginBottom:"24px"},children:[(0,n.jsx)(y.Z,{xs:24,sm:12,md:6,children:(0,n.jsx)(b.Z,{children:(0,n.jsx)(f.Z,{title:"Drivers",value:$,prefix:(0,n.jsx)(c.Z,{style:{color:"#1890ff"}}),valueStyle:{color:"#1890ff"}})})}),(0,n.jsx)(y.Z,{xs:24,sm:12,md:6,children:(0,n.jsx)(b.Z,{children:(0,n.jsx)(f.Z,{title:"Conductors",value:ee,prefix:(0,n.jsx)(i.Z,{style:{color:"#52c41a"}}),valueStyle:{color:"#52c41a"}})})}),(0,n.jsx)(y.Z,{xs:24,sm:12,md:6,children:(0,n.jsx)(b.Z,{children:(0,n.jsx)(f.Z,{title:"Commuters",value:es,prefix:(0,n.jsx)(a.Z,{style:{color:"#722ed1"}}),valueStyle:{color:"#722ed1"}})})}),(0,n.jsx)(y.Z,{xs:24,sm:12,md:6,children:(0,n.jsx)(b.Z,{children:(0,n.jsx)(f.Z,{title:"Admins",value:er,prefix:(0,n.jsx)(a.Z,{style:{color:"#fa8c16"}}),valueStyle:{color:"#fa8c16"}})})})]}),en>0&&(0,n.jsx)(j.Z,{gutter:[16,16],style:{marginBottom:"24px"},children:(0,n.jsx)(y.Z,{span:24,children:(0,n.jsx)(b.Z,{style:{border:"1px solid #ff4d4f"},children:(0,n.jsx)("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:(0,n.jsxs)(U,{style:{color:"#ff4d4f",fontWeight:"bold"},children:["⚠️ ",en," driver license(s) have expired"]})})})})}),(0,n.jsxs)(b.Z,{children:[(0,n.jsxs)("div",{style:{marginBottom:"16px",display:"flex",gap:"16px",flexWrap:"wrap"},children:[(0,n.jsx)(z,{placeholder:"Search by name, phone, or license...",style:{width:300},value:q,onChange:e=>J(e.target.value),prefix:(0,n.jsx)(o.Z,{})}),(0,n.jsxs)(u.default,{placeholder:"Filter by role",style:{width:150},value:M,onChange:Q,children:[(0,n.jsx)(N,{value:"all",children:"All Roles"}),(0,n.jsx)(N,{value:"admin",children:"Admin"}),(0,n.jsx)(N,{value:"driver",children:"Driver"}),(0,n.jsx)(N,{value:"conductor",children:"Conductor"}),(0,n.jsx)(N,{value:"commuter",children:"Commuter"})]})]}),(0,n.jsx)(Z.Z,{defaultActiveKey:"all",items:[{key:"all",label:"All Users (".concat(h.length,")"),children:(0,n.jsx)(w.Z,{columns:Y,dataSource:X(h),rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,s)=>"".concat(s[0],"-").concat(s[1]," of ").concat(e," users")},scroll:{x:1e3}})},{key:"drivers",label:"Drivers (".concat($,")"),children:(0,n.jsx)(w.Z,{columns:Y,dataSource:X(D),rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,s)=>"".concat(s[0],"-").concat(s[1]," of ").concat(e," drivers")},scroll:{x:1e3}})},{key:"conductors",label:"Conductors (".concat(ee,")"),children:(0,n.jsx)(w.Z,{columns:Y,dataSource:X(B),rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,s)=>"".concat(s[0],"-").concat(s[1]," of ").concat(e," conductors")},scroll:{x:1e3}})},{key:"commuters",label:"Commuters (".concat(es,")"),children:(0,n.jsx)(w.Z,{columns:Y,dataSource:X(O),rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,s)=>"".concat(s[0],"-").concat(s[1]," of ").concat(e," commuters")},scroll:{x:1e3}})}]})]})]})]})}},1370:function(e,s,r){"use strict";r.d(s,{sn:function(){return l}});var n=r(6881);class t{subscribeToTrips(e){let s=n.O.channel("trips-changes").on("postgres_changes",{event:"*",schema:"public",table:"trips"},s=>{var r;console.log("Trip change received:",s),null===(r=e.onTripUpdate)||void 0===r||r.call(e,s)}).subscribe();return this.channels.set("trips",s),s}subscribeToBuses(e){let s=n.O.channel("buses-changes").on("postgres_changes",{event:"*",schema:"public",table:"buses"},s=>{var r;console.log("Bus change received:",s),null===(r=e.onBusUpdate)||void 0===r||r.call(e,s)}).subscribe();return this.channels.set("buses",s),s}subscribeToUsers(e){let s=n.O.channel("users-changes").on("postgres_changes",{event:"*",schema:"public",table:"users"},s=>{var r;console.log("User change received:",s),null===(r=e.onUserUpdate)||void 0===r||r.call(e,s)}).subscribe();return this.channels.set("users",s),s}subscribeToTripPassengers(e){let s=n.O.channel("trip-passengers-changes").on("postgres_changes",{event:"*",schema:"public",table:"trip_passengers"},s=>{var r;console.log("Trip passenger change received:",s),null===(r=e.onTripUpdate)||void 0===r||r.call(e,s)}).subscribe();return this.channels.set("trip_passengers",s),s}subscribeToAll(e){this.subscribeToTrips(e),this.subscribeToBuses(e),this.subscribeToUsers(e),this.subscribeToTripPassengers(e)}unsubscribe(e){let s=this.channels.get(e);s&&(n.O.removeChannel(s),this.channels.delete(e))}unsubscribeAll(){this.channels.forEach((e,s)=>{n.O.removeChannel(e)}),this.channels.clear()}getChannelStatus(e){let s=this.channels.get(e);return s?s.state:"not_subscribed"}getActiveChannels(){return Array.from(this.channels.keys())}constructor(){this.channels=new Map}}let l=new t}},function(e){e.O(0,[377,943,866,403,671,882,971,23,744],function(){return e(e.s=8864)}),_N_E=e.O()}]);