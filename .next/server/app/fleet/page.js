(()=>{var e={};e.id=330,e.ids=[330],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")},2595:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>l.a,__next_app__:()=>x,originalPathname:()=>u,pages:()=>o,routeModule:()=>p,tree:()=>d}),t(6008),t(9116),t(5866);var s=t(3191),a=t(8716),i=t(7922),l=t.n(i),n=t(5231),c={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>n[e]);t.d(r,c);let d=["",{children:["fleet",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,6008)),"D:\\React Native\\admin-dashboard\\app\\fleet\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,9116)),"D:\\React Native\\admin-dashboard\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,5866,23)),"next/dist/client/components/not-found-error"]}],o=["D:\\React Native\\admin-dashboard\\app\\fleet\\page.tsx"],u="/fleet/page",x={require:t,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/fleet/page",pathname:"/fleet",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},7471:(e,r,t)=>{Promise.resolve().then(t.bind(t,9532))},9532:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>D});var s=t(326),a=t(6024),i=t(490),l=t(1696),n=t(331),c=t(2226),d=t(9636),o=t(6865),u=t(6709),x=t(2170),p=t(2379),h=t(3204),v=t(8506),m=t(1063),y=t(4139),j=t(8106),f=t(784),g=t(1135),Z=t(3155),b=t(7214),P=t(9270),_=t(5047),S=t(7577),w=t(2972);t(3212);var k=t(1973);let{Title:A,Text:q}=d.default,{Option:C}=o.default;function D(){let{user:e,loading:r,isAdmin:t}=(0,k.a)(),d=(0,_.useRouter)(),[D,z]=(0,S.useState)([]),[N,M]=(0,S.useState)([]),[R,F]=(0,S.useState)(!0),[I,B]=(0,S.useState)(!1),[E,$]=(0,S.useState)(null),[T]=u.Z.useForm(),G=async()=>{try{F(!0);let[e,r]=await Promise.all([(0,w.gf)(),(0,w.jT)()]);if(e.error)throw e.error;if(r.error)throw r.error;let t=(e.data||[]).map(e=>({...e,routes:Array.isArray(e.routes)?e.routes[0]:e.routes,driver:Array.isArray(e.driver)?e.driver[0]:e.driver,conductor:Array.isArray(e.conductor)?e.conductor[0]:e.conductor}));z(t),M(r.data||[])}catch(e){console.error("Error loading fleet data:",e),x.ZP.error("Failed to load fleet data")}finally{F(!1)}},L=async(e,r)=>{try{let{error:t}=await (0,w.dc)(e,r);if(t)throw t;x.ZP.success(`Bus status updated to ${r}`),G()}catch(e){console.error("Error updating bus status:",e),x.ZP.error("Failed to update bus status")}},O=async e=>{if(E)try{let{error:r}=await (0,w.O2)(E.id,e.driverId);if(r)throw r;x.ZP.success("Driver assigned successfully"),B(!1),$(null),T.resetFields(),G()}catch(e){console.error("Error assigning driver:",e),x.ZP.error("Failed to assign driver")}},V=e=>{$(e),T.setFieldsValue({driverId:e.driver_id}),B(!0)},H=e=>{let r={active:{color:"green",text:"Active"},inactive:{color:"red",text:"Inactive"}}[e];return s.jsx(p.Z,{color:r.color,children:r.text})},J=[{title:"Plate Number",dataIndex:"plate_number",key:"plate_number",render:e=>s.jsx(q,{strong:!0,style:{color:"#1890ff"},children:e})},{title:"Route",key:"route",render:e=>(0,s.jsxs)("div",{children:[s.jsx(q,{strong:!0,children:e.routes?.name}),s.jsx("br",{}),(0,s.jsxs)(q,{type:"secondary",style:{fontSize:"12px"},children:[e.routes?.start_address," → ",e.routes?.end_address]})]})},{title:"Driver",key:"driver",render:e=>e.driver?(0,s.jsxs)("div",{children:[s.jsx(q,{children:e.driver.fullName}),s.jsx("br",{}),s.jsx(q,{type:"secondary",style:{fontSize:"12px"},children:e.driver.contact_number})]}):s.jsx(q,{type:"secondary",children:"No driver assigned"})},{title:"Capacity",key:"capacity",render:e=>(0,s.jsxs)("div",{children:[(0,s.jsxs)(q,{children:[e.passengers,"/",e.capacity]}),s.jsx("br",{}),(0,s.jsxs)(q,{type:"secondary",style:{fontSize:"12px"},children:[Math.round(e.passengers/e.capacity*100),"% full"]})]})},{title:"Status",dataIndex:"status",key:"status",render:e=>H(e)},{title:"Actions",key:"actions",render:e=>(0,s.jsxs)(h.Z,{children:[s.jsx(v.ZP,{type:"link",icon:s.jsx(a.Z,{}),onClick:()=>V(e),children:"Assign Driver"}),s.jsx(v.ZP,{type:"link",danger:"active"===e.status,onClick:()=>L(e.id,"active"===e.status?"inactive":"active"),children:"active"===e.status?"Deactivate":"Activate"})]})}],K=D.filter(e=>"active"===e.status).length,Q=D.reduce((e,r)=>e+r.capacity,0),X=D.reduce((e,r)=>e+r.passengers,0),U=D.filter(e=>e.driver_id).length;return r||R?s.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:s.jsx(m.Z,{size:"large"})}):(0,s.jsxs)("div",{className:"admin-layout",children:[(0,s.jsxs)("div",{className:"admin-header",children:[s.jsx("div",{className:"admin-logo",children:"Miniway Admin Dashboard"}),(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[s.jsx(v.ZP,{onClick:()=>d.push("/"),children:"Dashboard"}),s.jsx(v.ZP,{onClick:G,icon:s.jsx(i.Z,{}),children:"Refresh"})]})]}),(0,s.jsxs)("div",{className:"admin-content",children:[s.jsx(y.Z,{gutter:[16,16],style:{marginBottom:"24px"},children:(0,s.jsxs)(j.Z,{span:24,children:[s.jsx(A,{level:2,children:"Fleet Management"}),s.jsx(q,{type:"secondary",children:"Manage your bus fleet, assign drivers, and monitor capacity"})]})}),(0,s.jsxs)(y.Z,{gutter:[16,16],style:{marginBottom:"24px"},children:[s.jsx(j.Z,{xs:24,sm:12,md:6,children:s.jsx(f.Z,{children:s.jsx(g.Z,{title:"Active Buses",value:K,prefix:s.jsx(l.Z,{style:{color:"#52c41a"}}),valueStyle:{color:"#52c41a"}})})}),s.jsx(j.Z,{xs:24,sm:12,md:6,children:s.jsx(f.Z,{children:s.jsx(g.Z,{title:"Total Capacity",value:Q,prefix:s.jsx(n.Z,{style:{color:"#1890ff"}}),valueStyle:{color:"#1890ff"}})})}),s.jsx(j.Z,{xs:24,sm:12,md:6,children:s.jsx(f.Z,{children:s.jsx(g.Z,{title:"Current Passengers",value:X,prefix:s.jsx(n.Z,{style:{color:"#722ed1"}}),valueStyle:{color:"#722ed1"}})})}),s.jsx(j.Z,{xs:24,sm:12,md:6,children:s.jsx(f.Z,{children:s.jsx(g.Z,{title:"Buses with Drivers",value:U,prefix:s.jsx(c.Z,{style:{color:"#13c2c2"}}),valueStyle:{color:"#13c2c2"}})})})]}),s.jsx(f.Z,{title:"Bus Fleet",extra:s.jsx(h.Z,{children:s.jsx(v.ZP,{icon:s.jsx(i.Z,{}),onClick:G,children:"Refresh"})}),children:s.jsx(Z.Z,{columns:J,dataSource:D,rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,r)=>`${r[0]}-${r[1]} of ${e} buses`},scroll:{x:800}})}),s.jsx(b.Z,{title:"Assign Driver",open:I,onCancel:()=>{B(!1),$(null),T.resetFields()},footer:null,children:(0,s.jsxs)(u.Z,{form:T,layout:"vertical",onFinish:O,children:[s.jsx(u.Z.Item,{label:"Bus",name:"bus",initialValue:E?.plate_number,children:s.jsx(P.default,{disabled:!0})}),s.jsx(u.Z.Item,{label:"Driver",name:"driverId",rules:[{required:!0,message:"Please select a driver!"}],children:s.jsx(o.default,{placeholder:"Select a driver",children:N.map(e=>s.jsx(C,{value:e.id,children:(0,s.jsxs)("div",{children:[s.jsx(q,{strong:!0,children:e.fullName}),s.jsx("br",{}),(0,s.jsxs)(q,{type:"secondary",style:{fontSize:"12px"},children:[e.contact_number," • License:"," ",e.license_number]})]})},e.id))})}),s.jsx(u.Z.Item,{children:(0,s.jsxs)(h.Z,{children:[s.jsx(v.ZP,{type:"primary",htmlType:"submit",children:"Assign Driver"}),s.jsx(v.ZP,{onClick:()=>{B(!1),$(null),T.resetFields()},children:"Cancel"})]})})]})})]})]})}},2226:(e,r,t)=>{"use strict";t.d(r,{Z:()=>n});var s=t(5353),a=t(7577);let i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M699 353h-46.9c-10.2 0-19.9 4.9-25.9 13.3L469 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H325c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8a31.8 31.8 0 0051.7 0l210.6-292c3.9-5.3.1-12.7-6.4-12.7z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"check-circle",theme:"outlined"};var l=t(4082);let n=a.forwardRef(function(e,r){return a.createElement(l.Z,(0,s.Z)({},e,{ref:r,icon:i}))})},331:(e,r,t)=>{"use strict";t.d(r,{Z:()=>n});var s=t(5353),a=t(7577);let i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M858.5 763.6a374 374 0 00-80.6-119.5 375.63 375.63 0 00-119.5-80.6c-.4-.2-.8-.3-1.2-.5C719.5 518 760 444.7 760 362c0-137-111-248-248-248S264 225 264 362c0 82.7 40.5 156 102.8 201.1-.4.2-.8.3-1.2.5-44.8 18.9-85 46-119.5 80.6a375.63 375.63 0 00-80.6 119.5A371.7 371.7 0 00136 901.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8 2-77.2 33-149.5 87.8-204.3 56.7-56.7 132-87.9 212.2-87.9s155.5 31.2 212.2 87.9C779 752.7 810 825 812 902.2c.1 4.4 3.6 7.8 8 7.8h60a8 8 0 008-8.2c-1-47.8-10.9-94.3-29.5-138.2zM512 534c-45.9 0-89.1-17.9-121.6-50.4S340 407.9 340 362c0-45.9 17.9-89.1 50.4-121.6S466.1 190 512 190s89.1 17.9 121.6 50.4S684 316.1 684 362c0 45.9-17.9 89.1-50.4 121.6S557.9 534 512 534z"}}]},name:"user",theme:"outlined"};var l=t(4082);let n=a.forwardRef(function(e,r){return a.createElement(l.Z,(0,s.Z)({},e,{ref:r,icon:i}))})},6008:(e,r,t)=>{"use strict";t.r(r),t.d(r,{$$typeof:()=>l,__esModule:()=>i,default:()=>n});var s=t(8570);let a=(0,s.createProxy)(String.raw`D:\React Native\admin-dashboard\app\fleet\page.tsx`),{__esModule:i,$$typeof:l}=a;a.default;let n=(0,s.createProxy)(String.raw`D:\React Native\admin-dashboard\app\fleet\page.tsx#default`)}};var r=require("../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[206,399,454,371,817,214,699,222],()=>t(2595));module.exports=s})();